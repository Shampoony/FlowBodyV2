<template>
  <div class="v-calendar">
    <div class="container v-calendar__container">
      <div class="v-calendar__info info">
        <h1 class="v-rate__title title">–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</h1>
        <p class="v-calendar__subtitle subtitle">–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –≤–∞—à–∏—Ö —É—Ä–æ–∫–æ–≤</p>
      </div>

      <div class="v-calendar__content">
        <!-- –ó–∞–≥–æ–ª–æ–≤–∫–∏ –¥–Ω–µ–π –Ω–µ–¥–µ–ª–∏ -->
        <div class="v-calendar__header">
          <div class="v-calendar__day-header" v-for="day in dayHeaders" :key="day">
            {{ day }}
          </div>
        </div>

        <!-- –ö–∞–ª–µ–Ω–¥–∞—Ä–Ω–∞—è —Å–µ—Ç–∫–∞ -->
        <div class="v-calendar__grid">
          <div
            v-for="day in calendarDays"
            :key="day.date"
            class="v-calendar__day"
            :class="{
              'v-calendar__day--available': day.isAvailable,
              'v-calendar__day--other-month': day.isOtherMonth,
              'v-calendar__day--locked': day.isLocked,
            }"
            @click="selectDay(day)"
          >
            <span
              class="v-calendar__day-number"
              :class="{ locked: day.isLocked || day.isOtherMonth }"
              >{{ day.dayNumber }}</span
            >
            <div v-if="day.isLocked || day.isOtherMonth" class="v-calendar__lock">
              <img src="/src/assets/images/loock.svg" alt="" />
            </div>
          </div>
        </div>

        <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –≤–Ω–∏–∑—É -->
        <div class="v-calendar__indicators">
          <div class="v-calendar__indicator">
            <div class="v-calendar__indicator-dot"></div>
            <span class="v-calendar__indicator-text">–î–Ω–∏ —Å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞–º–∏</span>
          </div>
          <div class="v-calendar__level">
            <span class="v-calendar__level-text">–£—Ä–æ–≤–µ–Ω—å: –°—Ä–µ–¥–Ω–∏–π</span>
          </div>
        </div>
      </div>

      <ul class="v-calendar__list">
        <li class="v-calendar__list-item">
          <div class="calendar-row active">
            <div class="calendar-row__image">
              <img src="/src/assets/images/gym-icons/legs.jpg" alt="" class="calendar-row__image" />
            </div>

            <div class="calendar-row__content">
              <h3 class="calendar-row__title">–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ —Å–µ–≥–æ–¥–Ω—è</h3>
              <p class="calendar-row__subtitle">–∫–∞–∫–æ–π-—Ç–æ —Ç–µ–∫—Å—Ç –æ–± —ç—Ç–æ–º</p>
            </div>
            <div class="calendar-row__icon">
              <svg
                width="19"
                height="16"
                viewBox="0 0 19 16"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M1 7C0.447715 7 0 7.44772 0 8C0 8.55228 0.447715 9 1 9L1 7ZM17.9859 8.70711C18.3765 8.31658 18.3765 7.68342 17.9859 7.29289L11.622 0.928932C11.2314 0.538408 10.5983 0.538408 10.2078 0.928932C9.81723 1.31946 9.81723 1.95262 10.2078 2.34315L15.8646 8L10.2078 13.6569C9.81723 14.0474 9.81723 14.6805 10.2078 15.0711C10.5983 15.4616 11.2314 15.4616 11.622 15.0711L17.9859 8.70711ZM1 8L1 9L17.2788 9V8V7L1 7L1 8Z"
                  fill="#848484"
                />
              </svg>
            </div>
          </div>
        </li>
        <li class="v-calendar__list-item">
          <div class="calendar-row">
            <div class="calendar-row__image">
              <img src="/src/assets/images/gym-icons/legs.jpg" alt="" class="calendar-row__image" />
            </div>

            <div class="calendar-row__content">
              <h3 class="calendar-row__title">–î–µ–Ω—å –Ω–æ–≥</h3>
              <p class="calendar-row__subtitle">–∫–∞–∫–æ–π-—Ç–æ —Ç–µ–∫—Å—Ç –æ–± —ç—Ç–æ–º</p>
            </div>
            <div class="calendar-row__icon">
              <svg
                width="19"
                height="16"
                viewBox="0 0 19 16"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M1 7C0.447715 7 0 7.44772 0 8C0 8.55228 0.447715 9 1 9L1 7ZM17.9859 8.70711C18.3765 8.31658 18.3765 7.68342 17.9859 7.29289L11.622 0.928932C11.2314 0.538408 10.5983 0.538408 10.2078 0.928932C9.81723 1.31946 9.81723 1.95262 10.2078 2.34315L15.8646 8L10.2078 13.6569C9.81723 14.0474 9.81723 14.6805 10.2078 15.0711C10.5983 15.4616 11.2314 15.4616 11.622 15.0711L17.9859 8.70711ZM1 8L1 9L17.2788 9V8V7L1 7L1 8Z"
                  fill="#848484"
                />
              </svg>
            </div>
          </div>
        </li>
        <li class="v-calendar__list-item">
          <div class="calendar-row">
            <div class="calendar-row__image">
              <img
                src="/src/assets/images/gym-icons/hands.jpg"
                alt=""
                class="calendar-row__image"
              />
            </div>

            <div class="calendar-row__content">
              <h3 class="calendar-row__title">–î–µ–Ω—å —Ä—É–∫</h3>
              <p class="calendar-row__subtitle">–∫–∞–∫–æ–π-—Ç–æ —Ç–µ–∫—Å—Ç –æ–± —ç—Ç–æ–º</p>
            </div>
            <div class="calendar-row__icon">
              <svg
                width="19"
                height="16"
                viewBox="0 0 19 16"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M1 7C0.447715 7 0 7.44772 0 8C0 8.55228 0.447715 9 1 9L1 7ZM17.9859 8.70711C18.3765 8.31658 18.3765 7.68342 17.9859 7.29289L11.622 0.928932C11.2314 0.538408 10.5983 0.538408 10.2078 0.928932C9.81723 1.31946 9.81723 1.95262 10.2078 2.34315L15.8646 8L10.2078 13.6569C9.81723 14.0474 9.81723 14.6805 10.2078 15.0711C10.5983 15.4616 11.2314 15.4616 11.622 15.0711L17.9859 8.70711ZM1 8L1 9L17.2788 9V8V7L1 7L1 8Z"
                  fill="#848484"
                />
              </svg>
            </div>
          </div>
        </li>
        <li class="v-calendar__list-item">
          <div class="calendar-row">
            <div class="calendar-row__image">
              <img
                src="/src/assets/images/gym-icons/fullbody.jpg"
                alt=""
                class="calendar-row__image"
              />
            </div>

            <div class="calendar-row__content">
              <h3 class="calendar-row__title">–ù–∞ –≤—Å—ë —Ç–µ–ª–æ</h3>
              <p class="calendar-row__subtitle">–∫–∞–∫–æ–π-—Ç–æ —Ç–µ–∫—Å—Ç –æ–± —ç—Ç–æ–º</p>
            </div>
            <div class="calendar-row__icon">
              <svg
                width="19"
                height="16"
                viewBox="0 0 19 16"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M1 7C0.447715 7 0 7.44772 0 8C0 8.55228 0.447715 9 1 9L1 7ZM17.9859 8.70711C18.3765 8.31658 18.3765 7.68342 17.9859 7.29289L11.622 0.928932C11.2314 0.538408 10.5983 0.538408 10.2078 0.928932C9.81723 1.31946 9.81723 1.95262 10.2078 2.34315L15.8646 8L10.2078 13.6569C9.81723 14.0474 9.81723 14.6805 10.2078 15.0711C10.5983 15.4616 11.2314 15.4616 11.622 15.0711L17.9859 8.70711ZM1 8L1 9L17.2788 9V8V7L1 7L1 8Z"
                  fill="#848484"
                />
              </svg>
            </div>
          </div>
        </li>
      </ul>
    </div>
  </div>
</template>

<script setup>
import { ref, computed, onMounted } from 'vue'

const currentDate = ref(new Date())
const selectedDate = ref(null)
const dayHeaders = ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å']
const availableDays = [2, 4, 6, 8, 10, 12, 14, 16, 18, 20, 22, 24, 26, 28, 30] // –î–Ω–∏ —Å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞–º–∏

const calendarDays = computed(() => {
  const year = currentDate.value.getFullYear()
  const month = currentDate.value.getMonth()
  const today = new Date()

  // –ü–µ—Ä–≤—ã–π –¥–µ–Ω—å –º–µ—Å—è—Ü–∞
  const firstDay = new Date(year, month, 1)
  // –ü–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–Ω—å –º–µ—Å—è—Ü–∞
  const lastDay = new Date(year, month + 1, 0)

  // –ü–µ—Ä–≤—ã–π –¥–µ–Ω—å –Ω–µ–¥–µ–ª–∏ (–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ = 0)
  const firstWeekDay = (firstDay.getDay() + 6) % 7

  const days = []

  // –î–Ω–∏ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞
  for (let i = firstWeekDay - 1; i >= 0; i--) {
    const date = new Date(year, month, -i)
    days.push({
      date: date.getTime(),
      dayNumber: date.getDate(),
      isOtherMonth: true,
      isCurrent: false,
      isAvailable: false,
      isLocked: date.getDate() > 31,
    })
  }

  // –î–Ω–∏ —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞
  for (let day = 1; day <= lastDay.getDate(); day++) {
    const date = new Date(year, month, day)
    const isCurrent = date.toDateString() === today.toDateString()

    days.push({
      date: date.getTime(),
      dayNumber: day,
      isOtherMonth: false,
      isCurrent,
      isAvailable: availableDays.includes(day),
      isLocked: day > 31,
    })
  }

  // –î–Ω–∏ —Å–ª–µ–¥—É—é—â–µ–≥–æ –º–µ—Å—è—Ü–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å—Ç—Ä–æ–∫–∏)
  const totalDays = days.length
  const remainingInLastRow = totalDays % 7
  if (remainingInLastRow > 0) {
    const daysToAdd = 7 - remainingInLastRow
    for (let day = 1; day <= daysToAdd; day++) {
      const date = new Date(year, month + 1, day)
      days.push({
        dayNumber: day,
        isLocked: true,
      })
    }
  }

  return days
})

const selectDay = (day) => {
  if (!day.isOtherMonth && !day.isLocked) {
    selectedDate.value = day.date
    console.log('–í—ã–±—Ä–∞–Ω –¥–µ–Ω—å:', day.dayNumber)
  }
}

onMounted(() => {
  console.log('=== TELEGRAM WEBAPP DEBUG INFO ===')

  // 1. –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ WebApp
  if (window.Telegram?.WebApp) {
    console.log('üöÄ Telegram WebApp –¥–æ—Å—Ç—É–ø–µ–Ω!')
    console.log('WebApp –æ–±—ä–µ–∫—Ç:', window.Telegram.WebApp)

    // –û—Å–Ω–æ–≤–Ω—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞
    console.log('–í–µ—Ä—Å–∏—è:', window.Telegram.WebApp.version)
    console.log('–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞:', window.Telegram.WebApp.platform)
    console.log('–¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞:', window.Telegram.WebApp.colorScheme)
    console.log('–ì–æ—Ç–æ–≤:', window.Telegram.WebApp.isExpanded)

    // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
    console.log('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:', window.Telegram.WebApp.initDataUnsafe?.user)
    console.log('–ß–∞—Ç:', window.Telegram.WebApp.initDataUnsafe?.chat)
    console.log('Start param:', window.Telegram.WebApp.initDataUnsafe?.start_param)

    // –î–∞–Ω–Ω—ã–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
    console.log('Init Data:', window.Telegram.WebApp.initData)
    console.log('Init Data Unsafe:', window.Telegram.WebApp.initDataUnsafe)

    // –¢–µ–º–∞
    console.log('–¶–≤–µ—Ç–∞ —Ç–µ–º—ã:', window.Telegram.WebApp.themeParams)

    // Viewport
    console.log('–í—ã—Å–æ—Ç–∞ viewport:', window.Telegram.WebApp.viewportHeight)
    console.log('–°—Ç–∞–±–∏–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞:', window.Telegram.WebApp.viewportStableHeight)
  } else {
    console.log('‚ùå Telegram WebApp –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')
    console.log('–í–æ–∑–º–æ–∂–Ω–æ, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ –Ω–µ –≤ Telegram')
  }

  // 2. –ü–æ–ª–Ω—ã–π –æ–±—ä–µ–∫—Ç window.Telegram
  console.log('–ü–æ–ª–Ω—ã–π –æ–±—ä–µ–∫—Ç Telegram:', window.Telegram)

  // 3. –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ä–µ–¥–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
  console.log('User Agent:', navigator.userAgent)
  console.log('URL:', window.location.href)
  console.log('Referrer:', document.referrer)

  console.log('=== END DEBUG INFO ===')
})
</script>
